# Multi-Agent Architecture Decision Record (ADR) Workflow
#
# When facing a specific architectural decision, get perspectives from
# all three agents and synthesize into a formal ADR.
#
# This is useful for decisions like:
# - "Should we use PostgreSQL or MongoDB?"
# - "Monolith vs microservices for this project?"
# - "REST vs GraphQL vs gRPC?"
#
# Usage:
#   echo "Should we use a message queue or direct HTTP calls between services?" | comanda process architecture-decision.yaml

# All three agents analyze the decision in parallel
parallel-process:
  claude-analysis:
    input: STDIN
    model: claude-code
    action: |
      You are an architect analyzing a technical decision. Consider:

      1. What are the options being considered?
      2. What are the key decision criteria?
      3. Analyze pros/cons of each option
      4. Consider long-term implications
      5. Make a clear recommendation with confidence level (high/medium/low)

      Format:
      ## Options Identified
      ## Decision Criteria
      ## Analysis
      ### Option A: [name]
      - Pros:
      - Cons:
      - Best for:
      ### Option B: [name]
      ...
      ## Recommendation
      (Option + confidence + rationale)

      Decision to analyze:
    output: $CLAUDE_ANALYSIS

  gemini-analysis:
    input: STDIN
    model: gemini-cli
    action: |
      You are a solutions architect evaluating a technical decision. Focus on:

      1. Industry best practices and trends
      2. Real-world case studies (mention specific companies if relevant)
      3. Ecosystem and tooling considerations
      4. Team velocity and learning curve impact
      5. Your recommendation with confidence level

      Format:
      ## Industry Context
      ## Options Analysis
      ## Ecosystem Considerations
      ## Case Studies/Examples
      ## Recommendation
      (Option + confidence + rationale)

      Decision to analyze:
    output: $GEMINI_ANALYSIS

  codex-analysis:
    input: STDIN
    model: openai-codex
    action: |
      You are a principal engineer evaluating a technical decision. Focus on:

      1. Implementation complexity of each option
      2. Code maintainability implications
      3. Testing and debugging considerations
      4. Migration/reversibility if the decision proves wrong
      5. Your recommendation with confidence level

      Format:
      ## Implementation View
      ## Complexity Comparison
      ## Maintainability Impact
      ## Reversibility Assessment
      ## Recommendation
      (Option + confidence + rationale)

      Decision to analyze:
    output: $CODEX_ANALYSIS

# Synthesize into formal ADR
create-adr:
  input: |
    # Architecture Decision Analysis

    Three experts have analyzed this architectural decision. Synthesize their
    input into a formal Architecture Decision Record (ADR).

    ## Claude Code (Design Focus)
    $CLAUDE_ANALYSIS

    ## Gemini CLI (Industry Focus)
    $GEMINI_ANALYSIS

    ## OpenAI Codex (Implementation Focus)
    $CODEX_ANALYSIS
  model: claude-code
  action: |
    Create a formal Architecture Decision Record (ADR) synthesizing the three analyses.

    Use this format:

    # ADR-XXX: [Decision Title]

    ## Status
    Proposed | Accepted | Deprecated | Superseded

    ## Context
    (What is the issue we're deciding on? Why does this decision matter?)

    ## Decision Drivers
    (Key factors influencing this decision, synthesized from all three analyses)

    ## Considered Options
    (List all options that were evaluated)

    ## Decision Outcome
    **Chosen option:** "[option]"

    **Confidence:** High | Medium | Low

    **Consensus:** (Did all three agents agree? Note any dissent)

    ## Pros and Cons of Chosen Option
    ### Pros
    ### Cons

    ## Pros and Cons of Alternatives
    (Brief summary of why alternatives were not chosen)

    ## Implementation Notes
    (Practical guidance from the Codex analysis)

    ## References
    (Any case studies or resources mentioned)

    ## Decision Participants
    - Claude Code (System Design perspective)
    - Gemini CLI (Industry Best Practices perspective)
    - OpenAI Codex (Implementation perspective)

    ---
    *Generated by Comanda Multi-Agent Architecture Decision Workflow*

    Be decisive - choose one option and defend it clearly.
  output: STDOUT
