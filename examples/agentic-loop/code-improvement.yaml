# Software Engineering Agentic Loop Example - Plan and Build
# Usage: echo "Build a REST API endpoint for user registration" | comanda process examples/agentic-loop/code-improvement.yaml
#
# This example shows the block-style agentic loop syntax with plan and build phases.
# First loop: Iteratively refine the implementation plan until complete.
# Second loop: Iteratively build and fix the code until it compiles/works.

agentic-loop:
  config:
    max_iterations: 5
    timeout_seconds: 600
    exit_condition: llm_decides
    context_window: 3

  steps:
    plan:
      input: STDIN
      model: claude-code
      action: |
        You are a software architect planning an implementation. This is iteration {{ loop.iteration }}.

        Previous planning work:
        {{ loop.previous_output }}

        Create or refine the implementation plan:
        1. Break down the task into specific steps
        2. Identify files to create or modify
        3. List dependencies and imports needed
        4. Consider error handling and edge cases

        If the plan is complete and ready for implementation, respond with exactly: DONE

        Otherwise, continue refining the plan:
      output: $PLAN

    build:
      input: $PLAN
      model: claude-code
      action: |
        Based on the implementation plan, generate the code.

        If the plan says DONE, output the complete implementation.
        Otherwise, output a work-in-progress implementation based on the current plan.

        Focus on:
        - Clean, readable code
        - Proper error handling
        - Following the plan structure

        Output the code:
      output: STDOUT
